{% extends "layout.html" %}

{% block title %}
    Index
{% endblock %}

{% block main %}
<legend class = "border-bottom mb-4" style = "text-align:center"><h1>Welcome Back</h1></legend>
<div class="container">
    <div class = "row">
        <div class="col">
            <img class = "shadow p-1 mb-1 bg-body rounded" style="width:180px;height:180px;" src = "{{img_url}}" alt = "">
            <form action="" method = "POST" enctype = "multipart/form-data">
                {{ form.csrf_token }}
                <div>
                    {{form.picture.label()}}
                    {{form.picture(class="form-control-file")}}
                    {% if form.picture.errors%}
                        {%for error in form.picture.errors%}
                            <span class = 'text-danger'>{{error}}</span><br>
                        {% endfor%}
                    {% endif%}
                </div>
                <div>
                    {{form.submit(class = "btn btn-dark")}}
                </div>
            </form>
            <form action="/profile" method = "POST">
                <p>Click Here to change Username: </p>
                <input class = "col" type = "text" placeholder="New Username" name = "user_name">
                <button class = "col btn btn-dark" type="submit" name="change_id">Update</button>
            </form>
        </div>
        <div class="col">
            <h2>Cash Balance: <span style="color: #0000ff">{{money|usd}}</span> </h2>
            <form action = "/profile" method = "POST">
                <div class = "row">
                    <h5 class = "col">Click here to save money!</h5>
                    <input class = "col" type = "number" step="0.01" placeholder="amount" name = "amount">
                    <button class = "col btn btn-info" type="submit" name="save">Save Money</button>
                </div>
            </form>
        </div>
    </div>
</div>
<legend class = "border-bottom mb-4"></legend>
<h2 style = "text-align:center">Order History</h2>
<table class="table" style="width:90%;margin-left:auto;margin-right:auto;">
    <thead>
        <tr>
            <th scope="col">Order #</th>
            <th scope="col">Date</th>
            <th scope="col">Products</th>
            <th scope="col">Total Price</th>
        </tr>
    </thead>
    <tbody>
        {%for transaction in transaction_row %}
            <tr>
                <td>{{transaction['order_num']}}</td>
                <td>{{transaction['time']}}</td>
                <td>
                    {% for prodcut_item in transaction_product %}
                        {% if prodcut_item['order_num'] == transaction['order_num'] %}
                            {{prodcut_item['name']}};
                        {% endif %}
                    {% endfor %}
                </td>
                <td>{{transaction['price']|usd}}</td>
            </tr>
        {% endfor %}
    </tbody>
</table>

<legend class = "border-bottom mb-4"></legend>
<h2 style = "text-align:center">Products Summary</h2>
<table class="table" style="width:90%;margin-left:auto;margin-right:auto;">
    <thead>
        <tr>
            <th scope="col">Product Name</th>
            <th scope="col">Price</th>
            <th scope="col">Sold Date</th>
            <th scope="col">Status</th>
        </tr>
    </thead>
    <tbody>
        {%for product in product_sell %}
            <tr>
                <td>{{product['name']}}</td>
                <td>{{product['price']|usd}}</td>
                <td>
                    {%for item in product_time %}
                        {% if item['product_id'] == product['id'] %}
                            {% if product['sold'] != 0 %}
                                {{item['time']}}
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                </td>
                <td>
                    {% if product['sold'] == 0 %}
                        on sale
                    {% else %}
                        sold
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}